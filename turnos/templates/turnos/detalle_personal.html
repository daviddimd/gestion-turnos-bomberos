{% extends 'turnos/base.html' %}
{% block title %}{{ titulo }}{% endblock %}

{% block content %}

    <div class="card" style="padding: 15px; margin-bottom: 20px; background-color: white; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h3>Datos del Bombero</h3>
        <p><strong>Nombre Completo:</strong> {{ persona.Nombre }} {{ persona.Apellido }}</p>
        <p><strong>RUT:</strong> {{ persona.Rut }}</p>
        <p><strong>Área:</strong> {{ persona.ID_area.Nombre_area }}</p>
        <p><strong>Cargo:</strong> {{ persona.ID_cargo.Nombre_cargo }}</p>
        {% if persona.Email %}
            <p><strong>Email:</strong> {{ persona.Email }}</p>
        {% endif %}
    </div>

    <h2>Historial de Asistencia (Total: {{ historial_turnos|length }})</h2>
    
    {% if historial_turnos %}
        <div class="card" style="padding: 15px; overflow-x: auto; background-color: white; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <table style="width: 100%;">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Tipo de Turno</th>
                        <th>Estado de Asistencia</th>
                        <th>Hora de Inicio</th>
                        <th>Hora de Llegada Real</th>
                        <th>Tardanza (Min)</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    {% for registro in historial_turnos %}
                    <tr>
                        <td>{{ registro.Fecha|date:"d M Y" }}</td>
                        <td>{{ registro.ID_turno.Tipo_turno }}</td>
                        <td>
                            <span style="font-weight: bold; color: 
                                {% if registro.ID_estado.Nombre_estado == 'Normal' %}green
                                {% elif registro.ID_estado.Nombre_estado == 'Atraso' %}orange
                                {% elif registro.ID_estado.Nombre_estado == 'Ausente' %}red
                                {% endif %};">
                                {{ registro.ID_estado.Nombre_estado }}
                            </span>
                        </td>
                        <td>{{ registro.ID_turno.Hora_inicio|time:"H:i" }}</td>
                        <td>{% if registro.Hora_llegada_real %}{{ registro.Hora_llegada_real|time:"H:i" }}{% else %}N/A{% endif %}</td>
                        <td>{% if registro.Minutos_tardanza %}{{ registro.Minutos_tardanza }}{% else %}0{% endif %}</td>
                        
                        <td>
                            {% if perms.turnos.delete_registroturno %}
                                <a href="{% url 'eliminar_registro_turno' id_registro=registro.ID_registro %}" 
                                   onclick="return confirm('¿Estás seguro de que quieres eliminar este registro de turno (ID: {{ registro.ID_registro }})? Esta acción no se puede deshacer.');"
                                   style="color: red; text-decoration: none; font-weight: bold;">[ELIMINAR]</a>
                            {% else %}
                                <span style="color: #ccc;">-</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>Esta persona no tiene registros de turnos en el sistema.</p>
    {% endif %}

    <p style="margin-top: 20px;"><a href="{% url 'inicio' %}">← Volver al Panel</a></p>

{% endblock content %}