{% extends 'turnos/base.html' %}
{% block title %}Reporte Consolidado de Asistencia{% endblock %}

{% block content %}
    
    <h2>Resultados ({{ fecha_inicio_str }} al {{ fecha_fin_str }})</h2>

    <div class="filter-form">
        <form method="get" action="{% url 'reporte_asistencia' %}">
            <label for="fecha_inicio">Desde:</label>
            <input type="date" id="fecha_inicio" name="fecha_inicio" value="{{ fecha_inicio_str }}">
            
            <label for="fecha_fin">Hasta:</label>
            <input type="date" id="fecha_fin" name="fecha_fin" value="{{ fecha_fin_str }}">
            
            <button type="submit">Generar Reporte</button>
        </form>
    </div>

    <style>
        .filter-form { background-color: #f0f0f0; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .filter-form label, .filter-form input { margin-right: 10px; }
        .data-center { text-align: center; font-weight: bold; }
        .normal { color: green; }
        .atraso { color: orange; }
        .ausente { color: red; }
    </style>
    
    {% if reporte_consolidado %}
        <table>
            <thead>
                <tr>
                    <th rowspan="2">Bombero</th>
                    <th rowspan="2">Cargo / Área</th>
                    <th rowspan="2">Turnos Asignados</th>
                    <th colspan="3">Días de Asistencia</th>
                    <th rowspan="2">Tardanza Acumulada (min)</th>
                </tr>
                <tr>
                    <th class="normal">Normal</th>
                    <th class="atraso">Atraso</th>
                    <th class="ausente">Ausente</th>
                </tr>
            </thead>
            <tbody>
                {% for item in reporte_consolidado %}
                <tr>
                    <td>
                        <a href="{% url 'detalle_personal' rut=item.Rut %}">
                            {{ item.Nombre }} {{ item.Apellido }}
                        </a>
                    </td>
                    <td>{{ item.ID_cargo.Nombre_cargo }} / {{ item.ID_area.Nombre_area }}</td>
                    
                    <td class="data-center">{{ item.total_turnos }}</td>
                    <td class="data-center normal">{{ item.normal }}</td>
                    <td class="data-center atraso">{{ item.atraso }}</td>
                    <td class="data-center ausente">{{ item.ausente }}</td>
                    <td class="data-center">{{ item.minutos_tardanza_total|default:"0" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No se encontraron registros de turnos en el rango seleccionado.</p>
    {% endif %}
    
{% endblock content %}