{% extends 'turnos/base.html' %}
{% block title %}{{ titulo }}{% endblock %}
{% block content %}
<body>
    <h1>üìà {{ titulo }}</h1>

    <div class="filter-form">
        <form method="get" action="{% url 'reporte_asistencia' %}">
            <label for="fecha_inicio">Desde:</label>
            <input type="date" id="fecha_inicio" name="fecha_inicio" value="{{ fecha_inicio_str }}">
            
            <label for="fecha_fin">Hasta:</label>
            <input type="date" id="fecha_fin" name="fecha_fin" value="{{ fecha_fin_str }}">
            
            <button type="submit">Generar Reporte</button>
        </form>
    </div>

    <h2>Resultados ({{ fecha_inicio_str }} al {{ fecha_fin_str }})</h2>
    
    {% if reporte_consolidado %}
        <table>
            <thead>
                <tr>
                    <th rowspan="2">Bombero</th>
                    <th rowspan="2">Cargo / √Årea</th>
                    <th rowspan="2">Turnos Asignados</th>
                    <th colspan="3">D√≠as de Asistencia</th>
                    <th rowspan="2">Tardanza Acumulada (min)</th>
                </tr>
                <tr>
                    <th class="normal">Normal</th>
                    <th class="atraso">Atraso</th>
                    <th class="ausente">Ausente</th>
                </tr>
            </thead>
            <tbody>
                {% for item in reporte_consolidado %}
                <tr>
                    <td>
                        <a href="{% url 'detalle_personal' rut=item.persona.Rut %}">
                            {{ item.persona.Nombre }} {{ item.persona.Apellido }}
                        </a>
                    </td>
                    <td>{{ item.persona.ID_cargo.Nombre_cargo }} / {{ item.persona.ID_area.Nombre_area }}</td>
                    <td class="data-center">{{ item.stats.total_turnos }}</td>
                    <td class="data-center normal">{{ item.stats.normal }}</td>
                    <td class="data-center atraso">{{ item.stats.atraso }}</td>
                    <td class="data-center ausente">{{ item.stats.ausente }}</td>
                    <td class="data-center">{{ item.stats.minutos_tardanza_total|default:"0" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No se encontraron registros de turnos en el rango seleccionado.</p>
    {% endif %}
    
    <p style="margin-top: 20px;"><a href="{% url 'inicio' %}">‚Üê Volver al Panel de Inicio</a></p>
{% endblock content %}